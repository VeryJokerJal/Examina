@model JoinOrganizationRequest
@using ExaminaWebApplication.Models.Organization.Requests
@{
    ViewData["Title"] = "加入组织";
    Layout = "_Layout";
}

<!-- 页面标题 -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>
            <i class="bi bi-plus-circle me-2"></i>加入组织
        </h2>
        <p class="text-muted mb-0">使用邀请码加入学校组织</p>
    </div>
    <div>
        <a href="/Teacher/Organization" class="glass-btn">
            <i class="bi bi-arrow-left me-2"></i>返回首页
        </a>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <!-- 加入表单 -->
        <div class="glass-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-key me-2"></i>输入邀请码
                </h5>
            </div>
            <div class="card-body">
                <form asp-action="Join" method="post" id="joinForm">
                    @Html.AntiForgeryToken()
                    
                    <div asp-validation-summary="All" class="text-danger mb-3"></div>

                    <!-- 邀请码输入 -->
                    <div class="mb-4">
                        <label asp-for="InvitationCode" class="form-label">
                            <i class="bi bi-key me-1"></i>@Html.DisplayNameFor(m => m.InvitationCode) <span class="text-danger">*</span>
                        </label>
                        <input asp-for="InvitationCode" class="form-control glass-input text-center" 
                               placeholder="请输入7位邀请码" maxlength="7" style="font-size: 1.2rem; letter-spacing: 0.2rem;" />
                        <span asp-validation-for="InvitationCode" class="text-danger"></span>
                        <div class="form-text text-center">
                            邀请码由7位字母和数字组成，不区分大小写
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="d-grid mb-3">
                        <button type="submit" class="glass-btn glass-btn-primary" id="submitBtn">
                            <i class="bi bi-check-circle me-2"></i>加入组织
                        </button>
                    </div>

                    <!-- 取消按钮 -->
                    <div class="text-center">
                        <a href="/Teacher/Organization" class="text-decoration-none">
                            <i class="bi bi-x-circle me-1"></i>取消
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- 帮助信息 -->
        <div class="glass-card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>加入说明
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-info glass-alert-info">
                    <h6 class="alert-heading">
                        <i class="bi bi-mortarboard me-1"></i>教师权限说明
                    </h6>
                    <ul class="mb-0 small">
                        <li>教师只能加入<strong>学校类型</strong>的组织</li>
                        <li>不能加入机构类型的组织</li>
                        <li>需要使用有效的邀请码进行加入</li>
                        <li>加入后可以查看组织信息和成员列表</li>
                    </ul>
                </div>

                <div class="mb-3">
                    <h6 class="text-primary">
                        <i class="bi bi-question-circle me-1"></i>如何获取邀请码？
                    </h6>
                    <ul class="small mb-0">
                        <li>联系学校管理员获取邀请码</li>
                        <li>邀请码由管理员在系统中生成</li>
                        <li>每个邀请码可能有使用次数限制</li>
                        <li>邀请码可能有有效期限制</li>
                    </ul>
                </div>

                <div class="alert alert-warning glass-alert-warning">
                    <h6 class="alert-heading">
                        <i class="bi bi-exclamation-triangle me-1"></i>注意事项
                    </h6>
                    <ul class="mb-0 small">
                        <li>请确保邀请码的准确性</li>
                        <li>邀请码区分大小写</li>
                        <li>过期或已用完的邀请码无法使用</li>
                        <li>不能重复加入同一个组织</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 常见问题 -->
        <div class="glass-card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-question-circle me-2"></i>常见问题
                </h6>
            </div>
            <div class="card-body">
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item glass-card">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed glass-btn" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#faq1">
                                邀请码无效怎么办？
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p class="small mb-0">
                                    请检查邀请码是否输入正确，确认邀请码没有过期或达到使用上限。
                                    如果问题仍然存在，请联系组织管理员重新生成邀请码。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item glass-card">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed glass-btn" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#faq2">
                                为什么不能加入某些组织？
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p class="small mb-0">
                                    教师用户只能加入学校类型的组织，不能加入机构类型的组织。
                                    这是系统的权限设计，确保不同类型的用户加入适合的组织。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item glass-card">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed glass-btn" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#faq3">
                                加入组织后可以做什么？
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p class="small mb-0">
                                    加入组织后，您可以查看组织信息、成员列表，参与组织的教学活动。
                                    具体功能会根据系统的后续开发逐步完善。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // 表单提交处理
        document.getElementById('joinForm').addEventListener('submit', function(e) {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>加入中...';
            submitBtn.disabled = true;
        });

        // 邀请码输入处理
        document.getElementById('InvitationCode').addEventListener('input', function(e) {
            // 转换为大写
            this.value = this.value.toUpperCase();
            
            // 只允许字母和数字
            this.value = this.value.replace(/[^A-Z0-9]/g, '');
            
            // 限制长度
            if (this.value.length > 7) {
                this.value = this.value.substring(0, 7);
            }
        });

        // 页面加载完成后聚焦到邀请码输入框
        document.addEventListener('DOMContentLoaded', function() {
            const codeInput = document.getElementById('InvitationCode');
            if (codeInput) {
                codeInput.focus();
            }
        });

        // 回车键快捷提交
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const form = document.getElementById('joinForm');
                if (form && document.activeElement.tagName !== 'BUTTON') {
                    form.submit();
                }
            }
        });
    </script>
}

<style>
    .glass-alert-info {
        background: rgba(13, 202, 240, 0.1);
        border: 1px solid rgba(13, 202, 240, 0.2);
        color: var(--text-primary);
    }

    .glass-alert-info .alert-heading {
        color: #0dcaf0;
    }

    .glass-alert-warning {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.2);
        color: var(--text-primary);
    }

    .glass-alert-warning .alert-heading {
        color: #ffc107;
    }

    .form-text {
        color: var(--text-secondary);
    }

    .text-danger {
        color: #dc3545 !important;
    }

    .glass-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    .accordion-item {
        background: transparent;
        border: none;
        margin-bottom: 0.5rem;
    }

    .accordion-button {
        background: var(--glass-secondary);
        border: 1px solid var(--glass-border);
        color: var(--text-primary);
    }

    .accordion-button:not(.collapsed) {
        background: var(--glass-primary);
        color: var(--text-primary);
        box-shadow: none;
    }

    .accordion-body {
        background: var(--glass-secondary);
        border: 1px solid var(--glass-border);
        border-top: none;
    }
</style>
