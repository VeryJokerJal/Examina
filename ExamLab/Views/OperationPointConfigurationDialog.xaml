<?xml version="1.0" encoding="utf-8" ?>
<ContentDialog x:Class="ExamLab.Views.OperationPointConfigurationDialog"
               xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               xmlns:converters="using:ExamLab.Converters"
               xmlns:models="using:ExamLab.Models"
               Title="操作点配置"
               PrimaryButtonText="保存"
               SecondaryButtonText="取消"
               DefaultButton="Primary"
               Style="{StaticResource DefaultContentDialogStyle}">

    <ContentDialog.Resources>
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </ContentDialog.Resources>

    <ScrollViewer MaxHeight="600" VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="16" Margin="0,0,0,16">
            <!-- 操作点基本信息 -->
            <Border Padding="16" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultSolidBrush}" 
                    BorderThickness="1" CornerRadius="8">
                <StackPanel Spacing="12">
                    <TextBlock Text="操作点信息" FontSize="16" FontWeight="SemiBold" />
                    
                    <TextBlock Text="{Binding OperationPoint.Name}" FontSize="14" FontWeight="Medium" />
                    <TextBlock Text="{Binding OperationPoint.Description}" 
                               FontSize="12" 
                               Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                               TextWrapping="Wrap" />
                    
                    <StackPanel Orientation="Horizontal" Spacing="16">
                        <TextBlock FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                            <Run Text="分值:" />
                            <Run Text="{Binding OperationPoint.Score}" />
                        </TextBlock>
                        <TextBlock FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                            <Run Text="模块类型:" />
                            <Run Text="{Binding OperationPoint.ModuleType}" />
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- 配置参数管理 -->
            <Border Padding="16" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultSolidBrush}" 
                    BorderThickness="1" CornerRadius="8">
                <StackPanel Spacing="12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="配置参数" FontSize="16" FontWeight="SemiBold" />
                        
                        <Button Grid.Column="1" 
                                Content="添加参数" 
                                Command="{Binding AddParameterCommand}"
                                Style="{ThemeResource AccentButtonStyle}" />
                    </Grid>
                    
                    <!-- 参数列表 -->
                    <Border Background="{ThemeResource LayerFillColorDefaultBrush}" 
                            CornerRadius="4" 
                            Visibility="{Binding OperationPoint.Parameters.Count, Converter={StaticResource CountToVisibilityConverter}}">
                        <ListView x:Name="ParameterListView"
                                  ItemsSource="{Binding OperationPoint.Parameters}"
                                  SelectedItem="{Binding SelectedParameter, Mode=TwoWay}"
                                  Background="Transparent"
                                  MaxHeight="300">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" />
                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                                                       TextTrimming="CharacterEllipsis" />
                                            <StackPanel Orientation="Horizontal" Spacing="12">
                                                <TextBlock FontSize="11" 
                                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                                                    <Run Text="类型:" />
                                                    <Run Text="{Binding Type}" />
                                                </TextBlock>
                                                <TextBlock FontSize="11" 
                                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                                                    <Run Text="必填:" />
                                                    <Run Text="{Binding IsRequired}" />
                                                </TextBlock>
                                                <TextBlock FontSize="11" 
                                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                                                    <Run Text="值:" />
                                                    <Run Text="{Binding Value}" />
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <Button Grid.Column="1"
                                                Content="编辑"
                                                Command="{Binding DataContext.EditParameterCommand, ElementName=ParameterListView}"
                                                CommandParameter="{Binding}"
                                                Style="{ThemeResource DefaultButtonStyle}"
                                                Margin="4,0" />

                                        <Button Grid.Column="2"
                                                Content="删除"
                                                Command="{Binding DataContext.DeleteParameterCommand, ElementName=ParameterListView}"
                                                CommandParameter="{Binding}"
                                                Style="{ThemeResource DefaultButtonStyle}"
                                                Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                                Margin="4,0" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Border>
                    
                    <!-- 空状态提示 -->
                    <Border Padding="16" 
                            Background="{ThemeResource LayerFillColorDefaultBrush}" 
                            CornerRadius="4"
                            Visibility="{Binding OperationPoint.Parameters.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Zero}">
                        <StackPanel HorizontalAlignment="Center" Spacing="8">
                            <FontIcon FontSize="24" 
                                      Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                                      Glyph="&#xE713;" />
                            <TextBlock Text="暂无配置参数" 
                                       HorizontalAlignment="Center" 
                                       FontSize="14" 
                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock Text="点击上方"添加参数"按钮开始配置" 
                                       HorizontalAlignment="Center" 
                                       FontSize="12" 
                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>

            <!-- 参数统计信息 -->
            <Border Padding="16" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultSolidBrush}" 
                    BorderThickness="1" CornerRadius="8">
                <StackPanel Spacing="12">
                    <TextBlock Text="配置统计" FontSize="16" FontWeight="SemiBold" />
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock Text="参数总数" 
                                       FontSize="12" 
                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock Text="{Binding OperationPoint.Parameters.Count}" 
                                       FontSize="20" 
                                       FontWeight="SemiBold" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Spacing="4">
                            <TextBlock Text="必填参数" 
                                       FontSize="12" 
                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock Text="{Binding RequiredParameterCount}" 
                                       FontSize="20" 
                                       FontWeight="SemiBold" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Spacing="4">
                            <TextBlock Text="已配置参数" 
                                       FontSize="12" 
                                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock Text="{Binding ConfiguredParameterCount}" 
                                       FontSize="20" 
                                       FontWeight="SemiBold" />
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
