<?xml version="1.0" encoding="utf-8" ?>
<UserControl x:Class="ExamLab.Views.OperationPointConfigView" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:converters="using:ExamLab.Converters" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="using:ExamLab.Views" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d">

    <UserControl.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:ParameterTypeToVisibilityConverter x:Key="ParameterTypeToVisibilityConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:ParameterVisibilityConverter x:Key="ParameterVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  操作点信息  -->
        <Border Grid.Row="0" Padding="16,12" Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}">
            <StackPanel Spacing="8">
                <TextBlock FontSize="18" FontWeight="SemiBold" Text="{Binding SelectedOperationPoint.Name}" />
                <TextBlock FontSize="14" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" Text="{Binding SelectedOperationPoint.Description}" />
            </StackPanel>
        </Border>

        <!--  参数配置区域  -->
        <ScrollViewer Grid.Row="1" Padding="16">
            <StackPanel Spacing="16" Visibility="{Binding SelectedOperationPoint, Converter={StaticResource NullToVisibilityConverter}}">
                <TextBlock FontSize="16" FontWeight="SemiBold" Text="参数配置" />

                <!--  动态参数列表  -->
                <ItemsControl ItemsSource="{Binding SelectedOperationPoint.Parameters}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0,0,0,12" Padding="16" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Visibility="{Binding IsVisible, Converter={StaticResource ParameterVisibilityConverter}}">
                                <StackPanel Spacing="8">
                                    <TextBlock FontWeight="SemiBold" Text="{Binding DisplayName}" />
                                    <TextBlock FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" Text="{Binding Description}" />

                                    <!--  根据参数类型显示不同的输入控件  -->

                                    <!--  文本输入  -->
                                    <TextBox PlaceholderText="{Binding DefaultValue}" Text="{Binding Value, Mode=TwoWay}" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=Text}" />

                                    <!--  数字输入  -->
                                    <NumberBox Maximum="{Binding MaxValue}" Minimum="-1" PlaceholderText="输入数值（-1表示匹配任意值）" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=Number}" Value="{Binding Value, Mode=TwoWay}" />

                                    <!--  布尔值输入  -->
                                    <CheckBox Content="{Binding DisplayName}" IsChecked="{Binding Value, Mode=TwoWay}" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=Boolean}" />

                                    <!--  枚举选择  -->
                                    <ComboBox ItemsSource="{Binding EnumOptionsList}" PlaceholderText="请选择..." SelectedItem="{Binding Value, Mode=TwoWay}" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=Enum}" />

                                    <!--  颜色选择  -->
                                    <StackPanel Orientation="Horizontal" Spacing="8" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=Color}">
                                        <ColorPicker x:Name="ColorPickerControl" Width="60" Height="40" ColorSpectrumShape="Box" IsAlphaEnabled="False" IsAlphaSliderVisible="True" IsAlphaTextInputVisible="True" IsColorChannelTextInputVisible="True" IsColorSliderVisible="True" IsHexInputVisible="True" IsMoreButtonVisible="False" />
                                        <TextBox Width="120" PlaceholderText="#B4F4FF" Text="{Binding Value, Mode=TwoWay}" />
                                    </StackPanel>

                                    <!--  文件路径  -->
                                    <StackPanel Orientation="Horizontal" Spacing="8" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=File}">
                                        <TextBox Width="300" PlaceholderText="选择文件路径" Text="{Binding Value, Mode=TwoWay}" />
                                        <Button Click="BrowseFile_Click" Content="浏览..." DataContext="{Binding}" />
                                    </StackPanel>

                                    <!--  多选  -->
                                    <ListView Height="120" ItemsSource="{Binding EnumOptionsList}" SelectionMode="Multiple" Visibility="{Binding Type, Converter={StaticResource ParameterTypeToVisibilityConverter}, ConverterParameter=MultipleChoice}">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox Content="{Binding}" />
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>

                                    <!--  必填标识  -->
                                    <TextBlock FontSize="12" Foreground="Red" Text="* 必填项" Visibility="{Binding IsRequired, Converter={StaticResource BoolToVisibilityConverter}}" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!--  无参数提示  -->
                <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" Text="此操作点无需配置参数" Visibility="{Binding SelectedOperationPoint.Parameters.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Zero}" />
            </StackPanel>
        </ScrollViewer>

        <!--  操作按钮  -->
        <Border Grid.Row="2" Padding="16" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}">
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" Spacing="12">
                <Button Click="SaveConfiguration_Click" Content="保存配置" Style="{ThemeResource AccentButtonStyle}" />
                <Button Click="ResetConfiguration_Click" Content="重置" />
                <Button Click="DeleteOperationPoint_Click" Content="删除操作点" />
            </StackPanel>
        </Border>

        <!--  无选中操作点时的提示  -->
        <Border Grid.RowSpan="3" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" Visibility="{Binding SelectedOperationPoint, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                <TextBlock HorizontalAlignment="Center" FontSize="18" Text="请选择一个操作点进行配置" />
                <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" Text="在左侧选择题目，然后添加或选择操作点" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
