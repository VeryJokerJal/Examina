<Window
    x:Class="Examina.Views.ExamToolbarWindow" xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:converters="using:Examina.Converters" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:ui="using:FluentAvalonia.UI.Controls" xmlns:vm="using:Examina.ViewModels" Title="考试工具栏" Width="1920"
    Height="60" d:DesignHeight="60" d:DesignWidth="1920" x:DataType="vm:ExamToolbarViewModel" Background="Transparent" CanResize="False" ExtendClientAreaChromeHints="NoChrome" ExtendClientAreaTitleBarHeightHint="-1" SystemDecorations="None" Topmost="True"
    TransparencyLevelHint="AcrylicBlur" WindowStartupLocation="Manual" mc:Ignorable="d">

    <Design.DataContext>
        <vm:ExamToolbarViewModel />
    </Design.DataContext>

    <!--  样式资源  -->
    <Window.Styles>
        <Style Selector="Button:pointerover">
            <Setter Property="Opacity" Value="0.8" />
        </Style>

        <Style Selector="Button:pressed">
            <Setter Property="Opacity" Value="0.6" />
        </Style>
    </Window.Styles>

    <!--  资源字典  -->
    <Window.Resources>
        <!--  转换器  -->
        <converters:BoolToTimeBrushConverter x:Key="BoolToTimeBrushConverter" />
        <converters:ExamStatusToStringConverter x:Key="ExamStatusToStringConverter" />
        <converters:ExamStatusToBrushConverter x:Key="ExamStatusToBrushConverter" />
        <converters:BoolToNetworkIconConverter x:Key="BoolToNetworkIconConverter" />
        <converters:BoolToNetworkBrushConverter x:Key="BoolToNetworkBrushConverter" />
        <converters:BoolToSubmitTextConverter x:Key="BoolToSubmitTextConverter" />

        <!--  考试工具栏背景色  -->
        <SolidColorBrush x:Key="ExamToolbarBackgroundBrush" Color="#E6000000" />

        <!--  考试工具栏边框色  -->
        <SolidColorBrush x:Key="ExamToolbarBorderBrush" Color="#FF007ACC" />

        <!--  考试工具栏前景色  -->
        <SolidColorBrush x:Key="ExamToolbarForegroundBrush" Color="#FFFFFF" />

        <!--  考试工具栏次要前景色  -->
        <SolidColorBrush x:Key="ExamToolbarSecondaryForegroundBrush" Color="#CCCCCC" />

        <!--  学生头像背景色  -->
        <SolidColorBrush x:Key="StudentAvatarBackgroundBrush" Color="#FF007ACC" />

        <!--  学生头像图标色  -->
        <SolidColorBrush x:Key="StudentAvatarIconBrush" Color="#FFFFFF" />

        <!--  工具栏按钮背景色  -->
        <SolidColorBrush x:Key="ExamToolbarButtonBackgroundBrush" Color="#FF333333" />

        <!--  工具栏按钮前景色  -->
        <SolidColorBrush x:Key="ExamToolbarButtonForegroundBrush" Color="#FFFFFF" />

        <!--  工具栏按钮边框色  -->
        <SolidColorBrush x:Key="ExamToolbarButtonBorderBrush" Color="#FF666666" />

        <!--  提交按钮背景色  -->
        <SolidColorBrush x:Key="ExamSubmitButtonBackgroundBrush" Color="#FF28A745" />

        <!--  提交按钮前景色  -->
        <SolidColorBrush x:Key="ExamSubmitButtonForegroundBrush" Color="#FFFFFF" />

        <!--  正常时间颜色  -->
        <SolidColorBrush x:Key="NormalTimeBrush" Color="#FFFFFF" />

        <!--  紧急时间颜色  -->
        <SolidColorBrush x:Key="UrgentTimeBrush" Color="#FFFF4444" />

        <!--  网络连接颜色  -->
        <SolidColorBrush x:Key="NetworkConnectedBrush" Color="#FF28A745" />

        <!--  网络断开颜色  -->
        <SolidColorBrush x:Key="NetworkDisconnectedBrush" Color="#FFFF4444" />

        <!--  对话框背景色  -->
        <SolidColorBrush x:Key="ExamDialogBackgroundBrush" Color="#FF2D2D30" />

        <!--  对话框边框色  -->
        <SolidColorBrush x:Key="ExamDialogBorderBrush" Color="#FF007ACC" />

        <!--  对话框前景色  -->
        <SolidColorBrush x:Key="ExamDialogForegroundBrush" Color="#FFFFFF" />

        <!--  对话框取消按钮背景色  -->
        <SolidColorBrush x:Key="ExamDialogCancelButtonBackgroundBrush" Color="#FF3C3C3C" />

        <!--  对话框取消按钮前景色  -->
        <SolidColorBrush x:Key="ExamDialogCancelButtonForegroundBrush" Color="#FFFFFF" />

        <!--  对话框取消按钮边框色  -->
        <SolidColorBrush x:Key="ExamDialogCancelButtonBorderBrush" Color="#FF666666" />

        <!--  进度条背景色  -->
        <SolidColorBrush x:Key="ExamProgressBackgroundBrush" Color="#FF3C3C3C" />

        <!--  进度条前景色  -->
        <SolidColorBrush x:Key="ExamProgressForegroundBrush" Color="#FF007ACC" />
    </Window.Resources>

    <!--  主容器 Grid，包含所有内容  -->
    <Grid>
        <!--  考试工具栏主容器  -->
        <Border BorderBrush="{DynamicResource ExamToolbarBorderBrush}" BorderThickness="0,0,0,1" CornerRadius="0">

            <!--  主要内容区域  -->
            <Grid Margin="15,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  左侧区域 - 学生信息  -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center" Orientation="Horizontal" Spacing="15">

                    <!--  学生头像图标  -->
                    <Border Width="36" Height="36" Background="{DynamicResource StudentAvatarBackgroundBrush}" CornerRadius="18">
                        <Path Width="20" Height="20" HorizontalAlignment="Center" VerticalAlignment="Center" Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" Fill="{DynamicResource StudentAvatarIconBrush}" Stretch="Uniform" />
                    </Border>

                    <!--  学生信息文本  -->
                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                        <TextBlock FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource ExamToolbarForegroundBrush}" Text="{Binding StudentName}" />
                    </StackPanel>
                </StackPanel>

                <!--  中间区域 - 考试时间  -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Orientation="Horizontal" Spacing="10">

                    <!--  时钟图标  -->
                    <Path Width="24" Height="24" Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z" Fill="{Binding IsTimeUrgent, Converter={StaticResource BoolToTimeBrushConverter}}" Stretch="Uniform" />

                    <!--  时间显示  -->
                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                        <!-- 倒计时模式：显示剩余时间 -->
                        <TextBlock HorizontalAlignment="Center" FontSize="11" Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}"
                                   Text="剩余时间" IsVisible="{Binding !UseForwardTiming}" />
                        <TextBlock HorizontalAlignment="Center" FontFamily="Consolas" FontSize="20" FontWeight="Bold"
                                   Foreground="{Binding IsTimeUrgent, Converter={StaticResource BoolToTimeBrushConverter}}"
                                   Text="{Binding FormattedRemainingTime}" IsVisible="{Binding !UseForwardTiming}" />

                        <!-- 正向计时模式：显示已用时间 -->
                        <TextBlock HorizontalAlignment="Center" FontSize="11" Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}"
                                   Text="已用时间" IsVisible="{Binding UseForwardTiming}" />
                        <TextBlock HorizontalAlignment="Center" FontFamily="Consolas" FontSize="20" FontWeight="Bold"
                                   Foreground="{DynamicResource ExamToolbarPrimaryForegroundBrush}"
                                   Text="{Binding FormattedElapsedTime}" IsVisible="{Binding UseForwardTiming}" />
                    </StackPanel>

                    <!--  考试状态  -->
                    <StackPanel Margin="20,0,0,0" VerticalAlignment="Center" Orientation="Vertical">
                        <TextBlock HorizontalAlignment="Center" FontSize="11" Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}" Text="考试状态" />
                        <TextBlock HorizontalAlignment="Center" FontSize="12" FontWeight="Medium" Foreground="{Binding CurrentExamStatus, Converter={StaticResource ExamStatusToBrushConverter}}" Text="{Binding CurrentExamStatus, Converter={StaticResource ExamStatusToStringConverter}}" />
                    </StackPanel>
                </StackPanel>

                <!--  查看题目按钮区域  -->
                <StackPanel Grid.Column="2" Margin="0,0,10,0" VerticalAlignment="Center" Orientation="Horizontal" Spacing="15">
                    <!--  查看题目按钮  -->
                    <Button Padding="12,6" Background="{DynamicResource ExamToolbarButtonBackgroundBrush}" BorderBrush="{DynamicResource ExamToolbarButtonBorderBrush}" BorderThickness="1" Command="{Binding ViewQuestionsCommand}" CornerRadius="4" FontSize="12" Foreground="{DynamicResource ExamToolbarButtonForegroundBrush}">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Path Width="14" Height="14" Data="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" Fill="{DynamicResource ExamToolbarButtonForegroundBrush}" Stretch="Uniform" />
                            <TextBlock Text="查看题目" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!--  右侧区域 - 提交按钮  -->
                <Button Grid.Column="3" Padding="20,8" Background="{DynamicResource ExamSubmitButtonBackgroundBrush}" BorderThickness="0" Command="{Binding SubmitExamCommand}" CornerRadius="6" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource ExamSubmitButtonForegroundBrush}" IsEnabled="{Binding CanSubmitExam}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!--  提交图标  -->
                        <Path Width="16" Height="16" VerticalAlignment="Center" Data="M9,16.17L4.83,12L3.41,13.41L9,19L21,7L19.59,5.59L9,16.17Z" Fill="{DynamicResource ExamSubmitButtonForegroundBrush}" IsVisible="{Binding !IsSubmitting}" Stretch="Uniform" />

                        <ui:ProgressRing VerticalAlignment="Center" IsActive="{Binding IsSubmitting}" IsVisible="{Binding IsSubmitting}" />
                        <TextBlock VerticalAlignment="Center" Text="{Binding IsSubmitting, Converter={StaticResource BoolToSubmitTextConverter}}" />
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>
