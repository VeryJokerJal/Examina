<Window x:Class="Examina.Views.ExamToolbarWindow"
        xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Examina.ViewModels"
        xmlns:converters="using:Examina.Converters"
        Title="考试工具栏"
        Width="1920"
        Height="60"
        d:DesignHeight="60"
        d:DesignWidth="1920"
        x:DataType="vm:ExamToolbarViewModel"
        CanResize="False"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1"
        SystemDecorations="None"
        Topmost="True"
        TransparencyLevelHint="AcrylicBlur"
        WindowStartupLocation="Manual"
        mc:Ignorable="d">

    <Design.DataContext>
        <vm:ExamToolbarViewModel />
    </Design.DataContext>

    <!-- 考试工具栏主容器 -->
    <Border Background="{DynamicResource ExamToolbarBackgroundBrush}"
            BorderBrush="{DynamicResource ExamToolbarBorderBrush}"
            BorderThickness="0,0,0,2"
            CornerRadius="0">
        
        <!-- 主要内容区域 -->
        <Grid Margin="15,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- 左侧区域 - 学生信息 -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Spacing="15">
                
                <!-- 学生头像图标 -->
                <Border Width="36"
                        Height="36"
                        Background="{DynamicResource StudentAvatarBackgroundBrush}"
                        CornerRadius="18">
                    <Path Width="20"
                          Height="20"
                          Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"
                          Fill="{DynamicResource StudentAvatarIconBrush}"
                          Stretch="Uniform"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center" />
                </Border>
                
                <!-- 学生信息文本 -->
                <StackPanel Orientation="Vertical"
                            VerticalAlignment="Center">
                    <TextBlock Text="{Binding StudentName}"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ExamToolbarForegroundBrush}" />
                    <TextBlock Text="{Binding StudentId, StringFormat='学号: {0}'}"
                               FontSize="11"
                               Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}" />
                </StackPanel>
            </StackPanel>

            <!-- 中间区域 - 考试时间 -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="10">
                
                <!-- 时钟图标 -->
                <Path Width="24"
                      Height="24"
                      Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z"
                      Fill="{Binding IsTimeUrgent, Converter={StaticResource BoolToTimeBrushConverter}}"
                      Stretch="Uniform" />
                
                <!-- 时间显示 -->
                <StackPanel Orientation="Vertical"
                            VerticalAlignment="Center">
                    <TextBlock Text="剩余时间"
                               FontSize="11"
                               Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding FormattedRemainingTime}"
                               FontSize="20"
                               FontWeight="Bold"
                               FontFamily="Consolas"
                               Foreground="{Binding IsTimeUrgent, Converter={StaticResource BoolToTimeBrushConverter}}"
                               HorizontalAlignment="Center" />
                </StackPanel>
                
                <!-- 考试状态 -->
                <StackPanel Orientation="Vertical"
                            VerticalAlignment="Center"
                            Margin="20,0,0,0">
                    <TextBlock Text="考试状态"
                               FontSize="11"
                               Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding CurrentExamStatus, Converter={StaticResource ExamStatusToStringConverter}}"
                               FontSize="12"
                               FontWeight="Medium"
                               Foreground="{Binding CurrentExamStatus, Converter={StaticResource ExamStatusToBrushConverter}}"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </StackPanel>

            <!-- 题目信息区域 -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Spacing="15"
                        IsVisible="{Binding ShowQuestionInfo}">
                
                <!-- 题目信息 -->
                <StackPanel Orientation="Vertical"
                            VerticalAlignment="Center">
                    <TextBlock Text="题目信息"
                               FontSize="11"
                               Foreground="{DynamicResource ExamToolbarSecondaryForegroundBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock FontSize="12"
                               FontWeight="Medium"
                               Foreground="{DynamicResource ExamToolbarForegroundBrush}"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0}/{1} 题">
                                <Binding Path="CurrentQuestionIndex" />
                                <Binding Path="TotalQuestions" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <!-- 查看题目按钮 -->
                <Button Command="{Binding ViewQuestionsCommand}"
                        Background="{DynamicResource ExamToolbarButtonBackgroundBrush}"
                        Foreground="{DynamicResource ExamToolbarButtonForegroundBrush}"
                        BorderThickness="1"
                        BorderBrush="{DynamicResource ExamToolbarButtonBorderBrush}"
                        CornerRadius="4"
                        Padding="12,6"
                        FontSize="12">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Path Width="14"
                              Height="14"
                              Data="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"
                              Fill="{DynamicResource ExamToolbarButtonForegroundBrush}"
                              Stretch="Uniform" />
                        <TextBlock Text="查看题目" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- 网络状态指示器 -->
            <StackPanel Grid.Column="3"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Spacing="8"
                        Margin="20,0">
                
                <!-- 网络状态图标 -->
                <Path Width="16"
                      Height="16"
                      Data="{Binding IsNetworkConnected, Converter={StaticResource BoolToNetworkIconConverter}}"
                      Fill="{Binding IsNetworkConnected, Converter={StaticResource BoolToNetworkBrushConverter}}"
                      Stretch="Uniform" />
                
                <!-- 刷新网络按钮 -->
                <Button Command="{Binding RefreshNetworkCommand}"
                        Width="24"
                        Height="24"
                        Background="Transparent"
                        BorderThickness="0"
                        ToolTip.Tip="刷新网络状态"
                        IsVisible="{Binding !IsNetworkConnected}">
                    <Path Width="12"
                          Height="12"
                          Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                          Fill="{DynamicResource ExamToolbarSecondaryForegroundBrush}"
                          Stretch="Uniform" />
                </Button>
            </StackPanel>

            <!-- 右侧区域 - 提交按钮 -->
            <Button Grid.Column="4"
                    Command="{Binding SubmitExamCommand}"
                    Background="{DynamicResource ExamSubmitButtonBackgroundBrush}"
                    Foreground="{DynamicResource ExamSubmitButtonForegroundBrush}"
                    BorderThickness="0"
                    CornerRadius="6"
                    Padding="20,8"
                    FontSize="14"
                    FontWeight="SemiBold"
                    IsEnabled="{Binding CanSubmitExam}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <!-- 提交图标 -->
                    <Path Width="16"
                          Height="16"
                          Data="M9,16.17L4.83,12L3.41,13.41L9,19L21,7L19.59,5.59L9,16.17Z"
                          Fill="{DynamicResource ExamSubmitButtonForegroundBrush}"
                          Stretch="Uniform"
                          IsVisible="{Binding !IsSubmitting}" />
                    
                    <!-- 加载图标 -->
                    <Path Width="16"
                          Height="16"
                          Data="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"
                          Fill="{DynamicResource ExamSubmitButtonForegroundBrush}"
                          Stretch="Uniform"
                          IsVisible="{Binding IsSubmitting}">
                        <Path.RenderTransform>
                            <RotateTransform />
                        </Path.RenderTransform>
                        <Path.Styles>
                            <Style Selector="Path[IsVisible=True]">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="INFINITE">
                                        <KeyFrame Cue="0%">
                                            <Setter Property="RenderTransform.Angle" Value="0" />
                                        </KeyFrame>
                                        <KeyFrame Cue="100%">
                                            <Setter Property="RenderTransform.Angle" Value="360" />
                                        </KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Path.Styles>
                    </Path>
                    
                    <TextBlock Text="{Binding IsSubmitting, Converter={StaticResource BoolToSubmitTextConverter}}" />
                </StackPanel>
            </Button>
        </Grid>
    </Border>

    <!-- 样式资源 -->
    <Window.Styles>
        <Style Selector="Button:pointerover">
            <Setter Property="Opacity" Value="0.8" />
        </Style>
        
        <Style Selector="Button:pressed">
            <Setter Property="Opacity" Value="0.6" />
        </Style>
    </Window.Styles>

    <!-- 资源字典 -->
    <Window.Resources>
        <!-- 转换器 -->
        <converters:BoolToTimeBrushConverter x:Key="BoolToTimeBrushConverter" />
        <converters:ExamStatusToStringConverter x:Key="ExamStatusToStringConverter" />
        <converters:ExamStatusToBrushConverter x:Key="ExamStatusToBrushConverter" />
        <converters:BoolToNetworkIconConverter x:Key="BoolToNetworkIconConverter" />
        <converters:BoolToNetworkBrushConverter x:Key="BoolToNetworkBrushConverter" />
        <converters:BoolToSubmitTextConverter x:Key="BoolToSubmitTextConverter" />

        <!-- 考试工具栏背景色 -->
        <SolidColorBrush x:Key="ExamToolbarBackgroundBrush" Color="#E6000000" />

        <!-- 考试工具栏边框色 -->
        <SolidColorBrush x:Key="ExamToolbarBorderBrush" Color="#FF007ACC" />

        <!-- 考试工具栏前景色 -->
        <SolidColorBrush x:Key="ExamToolbarForegroundBrush" Color="#FFFFFF" />

        <!-- 考试工具栏次要前景色 -->
        <SolidColorBrush x:Key="ExamToolbarSecondaryForegroundBrush" Color="#CCCCCC" />

        <!-- 学生头像背景色 -->
        <SolidColorBrush x:Key="StudentAvatarBackgroundBrush" Color="#FF007ACC" />

        <!-- 学生头像图标色 -->
        <SolidColorBrush x:Key="StudentAvatarIconBrush" Color="#FFFFFF" />

        <!-- 工具栏按钮背景色 -->
        <SolidColorBrush x:Key="ExamToolbarButtonBackgroundBrush" Color="#FF333333" />

        <!-- 工具栏按钮前景色 -->
        <SolidColorBrush x:Key="ExamToolbarButtonForegroundBrush" Color="#FFFFFF" />

        <!-- 工具栏按钮边框色 -->
        <SolidColorBrush x:Key="ExamToolbarButtonBorderBrush" Color="#FF666666" />

        <!-- 提交按钮背景色 -->
        <SolidColorBrush x:Key="ExamSubmitButtonBackgroundBrush" Color="#FF28A745" />

        <!-- 提交按钮前景色 -->
        <SolidColorBrush x:Key="ExamSubmitButtonForegroundBrush" Color="#FFFFFF" />

        <!-- 正常时间颜色 -->
        <SolidColorBrush x:Key="NormalTimeBrush" Color="#FFFFFF" />

        <!-- 紧急时间颜色 -->
        <SolidColorBrush x:Key="UrgentTimeBrush" Color="#FFFF4444" />

        <!-- 网络连接颜色 -->
        <SolidColorBrush x:Key="NetworkConnectedBrush" Color="#FF28A745" />

        <!-- 网络断开颜色 -->
        <SolidColorBrush x:Key="NetworkDisconnectedBrush" Color="#FFFF4444" />
    </Window.Resources>
</Window>
