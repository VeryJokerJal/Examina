<UserControl x:Class="Examina.Views.Pages.OverviewView" xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="clr-namespace:Examina.Views.Pages" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:vm="clr-namespace:Examina.ViewModels.Pages" d:DesignHeight="600" d:DesignWidth="800" x:DataType="vm:OverviewViewModel" mc:Ignorable="d">

    <ScrollViewer>
        <StackPanel Margin="24" Spacing="24">

            <!--  页面标题  -->
            <TextBlock FontSize="28" FontWeight="Bold" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" Text="{Binding PageTitle}" />

            <!--  欢迎消息  -->
            <Border Padding="20" Background="{DynamicResource SystemControlBackgroundAccentBrush}" CornerRadius="8">
                <StackPanel>
                    <TextBlock FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource SystemControlForegroundChromeWhiteBrush}" Text="{Binding WelcomeMessage}" TextWrapping="Wrap" />
                    <TextBlock Margin="0,8,0,0" FontSize="14" Foreground="{DynamicResource SystemControlForegroundChromeWhiteBrush}" Opacity="0.9" Text="开始您的学习之旅吧！" />
                </StackPanel>
            </Border>

            <!--  统计卡片  -->
            <Border Padding="24" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" BorderBrush="{DynamicResource SystemAccentColor}" BorderThickness="1" CornerRadius="8">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">

                    <!--  模拟考试次数  -->
                    <Button Padding="20,16" Background="{Binding SelectedStatisticType, Converter={x:Static local:StatisticTypeToBackgroundConverter.Instance}, ConverterParameter=MockExam}" BorderThickness="0" Command="{Binding SelectStatisticTypeCommand}" CommandParameter="MockExam" CornerRadius="6">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{DynamicResource MockExamHoverBrush}" />
                            </Style>
                        </Button.Styles>
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource MockExamTextColor}" Text="模拟考试次数" />
                            <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock FontSize="28" FontWeight="Bold" Foreground="{DynamicResource MockExamTextColorPrimary}" Text="{Binding MockExamCount}" />
                                <TextBlock Margin="4,0,0,4" VerticalAlignment="Bottom" FontSize="16" Foreground="{DynamicResource MockExamTextColor}" Text="次" />
                            </StackPanel>
                            <TextBlock Margin="0,8,0,0" HorizontalAlignment="Center" FontSize="12" Foreground="{DynamicResource MockExamTextColorSecondary}" Text="暂时没有考试记录" IsVisible="{Binding !HasMockExamRecords}" />
                            <TextBlock Margin="0,8,0,0" HorizontalAlignment="Center" FontSize="12" Foreground="{DynamicResource MockExamTextColorSecondary}" Text="点击查看成绩详情" IsVisible="{Binding HasMockExamRecords}" />
                        </StackPanel>
                    </Button>

                    <!--  综合实训  -->
                    <Button Padding="20,16" Background="{Binding SelectedStatisticType, Converter={x:Static local:StatisticTypeToBackgroundConverter.Instance}, ConverterParameter=ComprehensiveTraining}" BorderThickness="0" Command="{Binding SelectStatisticTypeCommand}" CommandParameter="ComprehensiveTraining" CornerRadius="6">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{DynamicResource ComprehensiveTrainingHoverBrush}" />
                            </Style>
                        </Button.Styles>
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource ComprehensiveTrainingTextColor}" Text="综合实训" />

                            <!-- 加载状态 -->
                            <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center" IsVisible="{Binding IsLoadingComprehensiveTrainingProgress}">
                                <TextBlock FontSize="14" Foreground="{DynamicResource ComprehensiveTrainingTextColor}" Text="加载中..." HorizontalAlignment="Center" />
                            </StackPanel>

                            <!-- 进度显示 -->
                            <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center" IsVisible="{Binding !IsLoadingComprehensiveTrainingProgress}">
                                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                    <TextBlock FontSize="28" FontWeight="Bold" Foreground="{DynamicResource ComprehensiveTrainingTextColorPrimary}" Text="{Binding ComprehensiveTrainingProgressText}" />
                                </StackPanel>

                                <!-- 进度条 -->
                                <ProgressBar Margin="0,8,0,0" Width="120" Height="6"
                                           Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                           Foreground="{DynamicResource ComprehensiveTrainingTextColorPrimary}"
                                           Value="{Binding ComprehensiveTrainingCompletionPercentage}"
                                           Maximum="100" />

                                <TextBlock Margin="0,4,0,0" HorizontalAlignment="Center" FontSize="12"
                                         Foreground="{DynamicResource ComprehensiveTrainingTextColorSecondary}"
                                         Text="{Binding ComprehensiveTrainingCompletionPercentage, StringFormat='{}{0:F1}% 完成'}" />
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <!--  专项练习  -->
                    <Button Padding="20,16" Background="{Binding SelectedStatisticType, Converter={x:Static local:StatisticTypeToBackgroundConverter.Instance}, ConverterParameter=SpecialPractice}" BorderThickness="0" Command="{Binding SelectStatisticTypeCommand}" CommandParameter="SpecialPractice" CornerRadius="6">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{DynamicResource SpecialPracticeHoverBrush}" />
                            </Style>
                        </Button.Styles>
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource SpecialPracticeTextColor}" Text="专项练习" />

                            <!-- 加载状态 -->
                            <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center" IsVisible="{Binding IsLoadingSpecialPracticeProgress}">
                                <TextBlock FontSize="14" Foreground="{DynamicResource SpecialPracticeTextColor}" Text="加载中..." HorizontalAlignment="Center" />
                            </StackPanel>

                            <!-- 进度显示 -->
                            <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center" IsVisible="{Binding !IsLoadingSpecialPracticeProgress}">
                                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                    <TextBlock FontSize="28" FontWeight="Bold" Foreground="{DynamicResource SpecialPracticeTextColorPrimary}" Text="{Binding SpecialPracticeProgressText}" />
                                </StackPanel>

                                <!-- 进度条 -->
                                <ProgressBar Margin="0,8,0,0" Width="120" Height="6"
                                           Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                           Foreground="{DynamicResource SpecialPracticeTextColorPrimary}"
                                           Value="{Binding SpecialPracticeCompletionPercentage}"
                                           Maximum="100" />

                                <TextBlock Margin="0,4,0,0" HorizontalAlignment="Center" FontSize="12"
                                         Foreground="{DynamicResource SpecialPracticeTextColorSecondary}"
                                         Text="{Binding SpecialPracticeCompletionPercentage, StringFormat='{}{0:F1}% 完成'}" />
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <!--  上机统考  -->
                    <Button Padding="20,16" Background="{Binding SelectedStatisticType, Converter={x:Static local:StatisticTypeToBackgroundConverter.Instance}, ConverterParameter=OnlineExam}" BorderThickness="0" Command="{Binding SelectStatisticTypeCommand}" CommandParameter="OnlineExam" CornerRadius="6">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{DynamicResource OnlineExamHoverBrush}" />
                            </Style>
                        </Button.Styles>
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource OnlineExamTextColor}" Text="上机统考" />
                            <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock FontSize="28" FontWeight="Bold" Foreground="{DynamicResource OnlineExamTextColorPrimary}" Text="{Binding OnlineExamCount}" />
                                <TextBlock Margin="4,0,0,4" VerticalAlignment="Bottom" FontSize="16" Foreground="{DynamicResource OnlineExamTextColor}" Text="次" />
                            </StackPanel>
                            <TextBlock Margin="0,8,0,0" HorizontalAlignment="Center" FontSize="12" Foreground="{DynamicResource OnlineExamTextColorSecondary}" Text="暂时没有考试记录" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>



            <!--  成绩列表  -->
            <StackPanel>
                <StackPanel Margin="0,0,0,16" Orientation="Horizontal">
                    <TextBlock FontSize="20" FontWeight="SemiBold" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0}成绩">
                                <Binding Converter="{x:Static local:StatisticTypeToDisplayNameConverter.Instance}" Path="SelectedStatisticType" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>

                <!--  表头  -->
                <Border Padding="16,14" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4,4,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="1*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}">
                            <TextBlock.Text>
                                <Binding Converter="{x:Static local:StatisticTypeToDisplayNameConverter.Instance}" Path="SelectedStatisticType" />
                            </TextBlock.Text>
                        </TextBlock>
                        <TextBlock Grid.Column="1" FontSize="15" FontWeight="SemiBold" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" Text="作答用时" />
                        <TextBlock Grid.Column="2" FontSize="15" FontWeight="SemiBold" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" Text="提交时间" />
                        <TextBlock Grid.Column="3" FontSize="15" FontWeight="SemiBold" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" Text="得分" />
                    </Grid>
                </Border>

                <!--  成绩列表  -->
                <Panel>
                    <!--  有数据时显示列表  -->
                    <ItemsControl IsVisible="{Binding DisplayedRecords.Count}" ItemsSource="{Binding DisplayedRecords}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="16,14" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1,0,1,1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="3*" />
                                            <ColumnDefinition Width="1*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" VerticalAlignment="Center" FontSize="14" FontWeight="Normal" Text="{Binding Name}" />
                                        <TextBlock Grid.Column="1" VerticalAlignment="Center" FontSize="14" FontWeight="Normal" Text="{Binding Duration}" />
                                        <TextBlock Grid.Column="2" VerticalAlignment="Center" FontSize="13" FontWeight="Normal" Text="{Binding FormattedCompletionTime}" />
                                        <Border Grid.Column="3" Padding="10,6" HorizontalAlignment="Left" VerticalAlignment="Center" Background="{DynamicResource SystemAccentColor}" CornerRadius="6">
                                            <TextBlock HorizontalAlignment="Center" FontSize="13" FontWeight="SemiBold" Text="{Binding Score, StringFormat='{}{0}分'}" />
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!--  无数据时显示空状态  -->
                    <Border Padding="40" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1,0,1,1" IsVisible="{Binding !DisplayedRecords.Count}">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock HorizontalAlignment="Center" FontSize="48" Opacity="0.5" Text="📝" />
                            <TextBlock Margin="0,16,0,0" HorizontalAlignment="Center" FontSize="16" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="暂无{0}记录">
                                        <Binding Converter="{x:Static local:StatisticTypeToDisplayNameConverter.Instance}" Path="SelectedStatisticType" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                            <TextBlock Margin="0,8,0,0" HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" Text="开始练习后，您的成绩记录将显示在这里" />
                        </StackPanel>
                    </Border>
                </Panel>

                <!--  分页  -->
                <StackPanel Margin="0,16,0,0" HorizontalAlignment="Right" Orientation="Horizontal">
                    <TextBlock Margin="0,0,8,0" VerticalAlignment="Center" FontSize="14" Foreground="#999999" Text="&lt;" />

                    <Border Margin="0,0,4,0" Padding="8,4" Background="{DynamicResource SystemAccentColor}" CornerRadius="4">
                        <TextBlock FontSize="14" FontWeight="SemiBold" Foreground="White" Text="1" />
                    </Border>

                    <Border Margin="0,0,4,0" Padding="8,4" Background="Transparent" CornerRadius="4">
                        <TextBlock FontSize="14" Foreground="#666666" Text="2" />
                    </Border>

                    <Border Margin="0,0,4,0" Padding="8,4" Background="Transparent" CornerRadius="4">
                        <TextBlock FontSize="14" Foreground="#666666" Text="3" />
                    </Border>

                    <Border Margin="0,0,4,0" Padding="8,4" Background="Transparent" CornerRadius="4">
                        <TextBlock FontSize="14" Foreground="#666666" Text="4" />
                    </Border>

                    <TextBlock Margin="4,0,4,0" VerticalAlignment="Center" FontSize="14" Foreground="#999999" Text="..." />

                    <Border Margin="0,0,8,0" Padding="8,4" Background="Transparent" CornerRadius="4">
                        <TextBlock FontSize="14" Foreground="#666666" Text="40" />
                    </Border>

                    <TextBlock VerticalAlignment="Center" FontSize="14" Foreground="#999999" Text="&gt;" />
                </StackPanel>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</UserControl>
