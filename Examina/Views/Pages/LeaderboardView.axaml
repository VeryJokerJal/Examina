<UserControl x:Class="Examina.Views.Pages.LeaderboardView" xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:vm="clr-namespace:Examina.ViewModels.Pages" d:DesignHeight="600" d:DesignWidth="800" x:DataType="vm:LeaderboardViewModel" mc:Ignorable="d">

    <ScrollViewer>
        <StackPanel Margin="24" Spacing="24">

            <!--  页面标题  -->
            <TextBlock FontFamily="Microsoft YaHei" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" Text="{Binding PageTitle}" />

            <!--  排行榜类型选择  -->
            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBlock VerticalAlignment="Center" FontFamily="Microsoft YaHei" FontSize="16" Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" Text="排行榜类型:" />
                <ComboBox MinWidth="200" DisplayMemberBinding="{Binding Name}" FontFamily="Microsoft YaHei" ItemsSource="{Binding LeaderboardTypes}" SelectedItem="{Binding SelectedLeaderboardType}" />

                <!--  试卷筛选器  -->
                <TextBlock VerticalAlignment="Center" FontFamily="Microsoft YaHei" FontSize="16" Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" IsVisible="{Binding ShowExamFilter}" Text="试卷筛选:" />
                <ComboBox MinWidth="150" DisplayMemberBinding="{Binding DisplayName}" FontFamily="Microsoft YaHei" IsVisible="{Binding ShowExamFilter}" ItemsSource="{Binding ExamFilters}" SelectedItem="{Binding SelectedExamFilter}" />

                <Button Padding="12,6" Command="{Binding RefreshLeaderboardCommand}" Content="刷新" FontFamily="Microsoft YaHei" />
            </StackPanel>

            <!--  内容区域  -->
            <Border MinHeight="400" Padding="0" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8">

                <!--  使用Grid作为容器来支持多个子元素  -->
                <Grid>
                    <!--  排行榜数据  -->
                    <DataGrid FontFamily="Microsoft YaHei" GridLinesVisibility="Horizontal" HeadersVisibility="Column" IsReadOnly="True" IsVisible="{Binding !IsLoading}" ItemsSource="{Binding LeaderboardData}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Width="80" Binding="{Binding Rank}" Header="排名" />
                            <DataGridTextColumn Width="150" Binding="{Binding Username}" Header="用户名" />
                            <DataGridTextColumn Width="100" Binding="{Binding Score}" Header="分数" />
                            <DataGridTextColumn Width="120" Binding="{Binding CompletionTime, StringFormat='{}{0:hh\\:mm\\:ss}'}" Header="用时" />
                            <DataGridTextColumn Width="180" Binding="{Binding CompletionDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Header="完成时间" />
                        </DataGrid.Columns>
                    </DataGrid>

                    <!--  加载状态  -->
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" IsVisible="{Binding IsLoading}" Spacing="12">
                        <ProgressBar Width="200" IsIndeterminate="True" />
                        <TextBlock HorizontalAlignment="Center" FontFamily="Microsoft YaHei" FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="正在加载排行榜数据..." />
                    </StackPanel>

                    <!--  错误信息  -->
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" Spacing="12">
                        <TextBlock HorizontalAlignment="Center" FontSize="48" Text="⚠️" />
                        <TextBlock MaxWidth="400" HorizontalAlignment="Center" FontFamily="Microsoft YaHei" FontSize="16" Foreground="{DynamicResource SystemControlErrorTextForegroundBrush}" Text="{Binding ErrorMessage}" TextWrapping="Wrap" />
                        <Button Padding="12,6" HorizontalAlignment="Center" Command="{Binding RefreshLeaderboardCommand}" Content="重试" />
                    </StackPanel>

                    <!--  空数据状态  -->
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                        <StackPanel.IsVisible>
                            <MultiBinding Converter="{x:Static BoolConverters.And}">
                                <Binding Path="!IsLoading" />
                                <Binding Converter="{x:Static StringConverters.IsNullOrEmpty}" Path="ErrorMessage" />
                                <Binding Converter="{x:Static ObjectConverters.Equal}" ConverterParameter="0" Path="LeaderboardData.Count" />
                            </MultiBinding>
                        </StackPanel.IsVisible>

                        <TextBlock HorizontalAlignment="Center" FontSize="48" Text="📊" />
                        <TextBlock HorizontalAlignment="Center" FontFamily="Microsoft YaHei" FontSize="16" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="暂无排行榜数据" />
                        <TextBlock HorizontalAlignment="Center" FontFamily="Microsoft YaHei" FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="当前还没有完成的考试或训练记录" />
                    </StackPanel>

                </Grid>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
