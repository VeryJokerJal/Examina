<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Examina.ViewModels.Pages"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Examina.Views.Pages.LeaderboardView"
             x:DataType="vm:LeaderboardViewModel">

  <ScrollViewer>
    <StackPanel Margin="24" Spacing="24">
      
      <!-- é¡µé¢æ ‡é¢˜ -->
      <TextBlock Text="{Binding PageTitle}" 
                 FontSize="28" 
                 FontWeight="Bold"
                 FontFamily="Microsoft YaHei"
                 Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
      
      <!-- æŽ’è¡Œæ¦œç±»åž‹é€‰æ‹© -->
      <StackPanel Orientation="Horizontal" Spacing="12">
        <TextBlock Text="æŽ’è¡Œæ¦œç±»åž‹:" 
                   FontSize="16"
                   FontFamily="Microsoft YaHei"
                   VerticalAlignment="Center"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <ComboBox ItemsSource="{Binding LeaderboardTypes}"
                  SelectedItem="{Binding SelectedLeaderboardType}"
                  DisplayMemberBinding="{Binding Name}"
                  MinWidth="200"
                  FontFamily="Microsoft YaHei"/>
        <Button Content="åˆ·æ–°" 
                Command="{Binding RefreshLeaderboardCommand}"
                Padding="12,6"
                FontFamily="Microsoft YaHei"/>
      </StackPanel>
      
      <!-- å†…å®¹åŒºåŸŸ -->
      <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
              CornerRadius="8"
              Padding="0"
              MinHeight="400">

        <!-- ä½¿ç”¨Gridä½œä¸ºå®¹å™¨æ¥æ”¯æŒå¤šä¸ªå­å…ƒç´  -->
        <Grid>
          <!-- æŽ’è¡Œæ¦œæ•°æ® -->
          <DataGrid ItemsSource="{Binding LeaderboardData}"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    FontFamily="Microsoft YaHei"
                    IsVisible="{Binding !IsLoading}">
            <DataGrid.Columns>
              <DataGridTextColumn Header="æŽ’å" Binding="{Binding Rank}" Width="80"/>
              <DataGridTextColumn Header="ç”¨æˆ·å" Binding="{Binding Username}" Width="150"/>
              <DataGridTextColumn Header="åˆ†æ•°" Binding="{Binding Score}" Width="100"/>
              <DataGridTextColumn Header="ç”¨æ—¶" Binding="{Binding CompletionTime, StringFormat='{}{0:hh\\:mm\\:ss}'}" Width="120"/>
              <DataGridTextColumn Header="å®Œæˆæ—¶é—´" Binding="{Binding CompletionDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="180"/>
            </DataGrid.Columns>
          </DataGrid>

          <!-- åŠ è½½çŠ¶æ€ -->
          <StackPanel IsVisible="{Binding IsLoading}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="12">
            <ProgressBar IsIndeterminate="True" Width="200"/>
            <TextBlock Text="æ­£åœ¨åŠ è½½æŽ’è¡Œæ¦œæ•°æ®..."
                       FontSize="14"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       HorizontalAlignment="Center"/>
          </StackPanel>

          <!-- é”™è¯¯ä¿¡æ¯ -->
          <StackPanel IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="12">
            <TextBlock Text="âš ï¸"
                       FontSize="48"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding ErrorMessage}"
                       FontSize="16"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlErrorTextForegroundBrush}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap"
                       MaxWidth="400"/>
            <Button Content="é‡è¯•"
                    Command="{Binding RefreshLeaderboardCommand}"
                    HorizontalAlignment="Center"
                    Padding="12,6"/>
          </StackPanel>

          <!-- ç©ºæ•°æ®çŠ¶æ€ -->
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="12">
            <StackPanel.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="!IsLoading"/>
                <Binding Path="ErrorMessage" Converter="{x:Static StringConverters.IsNullOrEmpty}"/>
                <Binding Path="LeaderboardData.Count" Converter="{x:Static ObjectConverters.Equal}" ConverterParameter="0"/>
              </MultiBinding>
            </StackPanel.IsVisible>

            <TextBlock Text="ðŸ“Š"
                       FontSize="48"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="æš‚æ— æŽ’è¡Œæ¦œæ•°æ®"
                       FontSize="16"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="å½“å‰è¿˜æ²¡æœ‰å®Œæˆçš„è€ƒè¯•æˆ–è®­ç»ƒè®°å½•"
                       FontSize="14"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       HorizontalAlignment="Center"/>
          </StackPanel>

        </Grid>
      </Border>
      
    </StackPanel>
  </ScrollViewer>
</UserControl>
