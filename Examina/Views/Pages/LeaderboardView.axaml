<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Examina.ViewModels.Pages"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Examina.Views.Pages.LeaderboardView"
             x:DataType="vm:LeaderboardViewModel">

  <ScrollViewer>
    <StackPanel Margin="24" Spacing="24">
      
      <!-- 页面标题 -->
      <TextBlock Text="{Binding PageTitle}" 
                 FontSize="28" 
                 FontWeight="Bold"
                 FontFamily="Microsoft YaHei"
                 Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
      
      <!-- 排行榜类型选择 -->
      <StackPanel Orientation="Horizontal" Spacing="12">
        <TextBlock Text="排行榜类型:" 
                   FontSize="16"
                   FontFamily="Microsoft YaHei"
                   VerticalAlignment="Center"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <ComboBox ItemsSource="{Binding LeaderboardTypes}"
                  SelectedItem="{Binding SelectedLeaderboardType}"
                  DisplayMemberBinding="{Binding Name}"
                  MinWidth="200"
                  FontFamily="Microsoft YaHei"/>
        <Button Content="刷新" 
                Command="{Binding RefreshLeaderboardCommand}"
                Padding="12,6"
                FontFamily="Microsoft YaHei"/>
      </StackPanel>
      
      <!-- 内容区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
              CornerRadius="8"
              Padding="0"
              MinHeight="400">

        <!-- 使用Grid作为容器来支持多个子元素 -->
        <Grid>
          <!-- 排行榜数据 -->
          <DataGrid ItemsSource="{Binding LeaderboardData}"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    FontFamily="Microsoft YaHei"
                    IsVisible="{Binding !IsLoading}">
            <DataGrid.Columns>
              <DataGridTextColumn Header="排名" Binding="{Binding Rank}" Width="80"/>
              <DataGridTextColumn Header="用户名" Binding="{Binding Username}" Width="150"/>
              <DataGridTextColumn Header="分数" Binding="{Binding Score}" Width="100"/>
              <DataGridTextColumn Header="用时" Binding="{Binding CompletionTime, StringFormat='{}{0:hh\\:mm\\:ss}'}" Width="120"/>
              <DataGridTextColumn Header="完成时间" Binding="{Binding CompletionDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="180"/>
            </DataGrid.Columns>
          </DataGrid>

          <!-- 加载状态 -->
          <StackPanel IsVisible="{Binding IsLoading}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="12">
            <ProgressBar IsIndeterminate="True" Width="200"/>
            <TextBlock Text="正在加载排行榜数据..."
                       FontSize="14"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       HorizontalAlignment="Center"/>
          </StackPanel>

          <!-- 错误信息 -->
          <StackPanel IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="12">
            <TextBlock Text="⚠️"
                       FontSize="48"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding ErrorMessage}"
                       FontSize="16"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlErrorTextForegroundBrush}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap"
                       MaxWidth="400"/>
            <Button Content="重试"
                    Command="{Binding RefreshLeaderboardCommand}"
                    HorizontalAlignment="Center"
                    Padding="12,6"/>
          </StackPanel>

          <!-- 空数据状态 -->
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="12">
            <StackPanel.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="!IsLoading"/>
                <Binding Path="ErrorMessage" Converter="{x:Static StringConverters.IsNullOrEmpty}"/>
                <Binding Path="LeaderboardData.Count" Converter="{x:Static ObjectConverters.Equal}" ConverterParameter="0"/>
              </MultiBinding>
            </StackPanel.IsVisible>

            <TextBlock Text="📊"
                       FontSize="48"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="暂无排行榜数据"
                       FontSize="16"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="当前还没有完成的考试或训练记录"
                       FontSize="14"
                       FontFamily="Microsoft YaHei"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       HorizontalAlignment="Center"/>
          </StackPanel>

        </Grid>
      </Border>
      
    </StackPanel>
  </ScrollViewer>
</UserControl>
