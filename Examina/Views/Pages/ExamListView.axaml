<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Examina.ViewModels.Pages"
             xmlns:models="using:Examina.Models.Exam"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Examina.Views.Pages.ExamListView"
             x:DataType="vm:ExamListViewModel">

    <Design.DataContext>
        <vm:ExamListViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="{DynamicResource SystemAccentColor}" Padding="20,15">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ“" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="ä¸Šæœºç»Ÿè€ƒ" FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalCount, StringFormat={}å…± {0} åœºè€ƒè¯•}"
                          FontSize="14" Foreground="White" Opacity="0.8" 
                          VerticalAlignment="Center" Margin="20,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel Spacing="15">
                <!-- é”™è¯¯æ¶ˆæ¯ -->
                <Border IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                        Background="#FFEBEE" BorderBrush="#F44336" BorderThickness="1" 
                        CornerRadius="5" Padding="15">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âš ï¸" FontSize="16" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding ErrorMessage}" Foreground="#D32F2F" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
                <Border IsVisible="{Binding IsLoading}"
                        Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                        CornerRadius="5" Padding="20">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <TextBlock Text="æ­£åœ¨åŠ è½½è€ƒè¯•åˆ—è¡¨..." VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- è€ƒè¯•åˆ—è¡¨ -->
                <ItemsControl ItemsSource="{Binding Exams}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:StudentExamDto">
                            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                                    CornerRadius="8" Padding="20" Margin="0,0,0,10"
                                    BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                    BorderThickness="1">
                                <Border.Styles>
                                    <Style Selector="Border:pointerover">
                                        <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListLowBrush}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}"/>
                                    </Style>
                                </Border.Styles>

                                <Grid ColumnDefinitions="*,Auto">
                                    <!-- è€ƒè¯•ä¿¡æ¯ -->
                                    <StackPanel Grid.Column="0" Spacing="8">
                                        <!-- è€ƒè¯•åç§°å’ŒçŠ¶æ€ -->
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <TextBlock Text="{Binding Name}" FontSize="18" FontWeight="SemiBold"/>
                                            <Border Background="{DynamicResource SystemAccentColor}"
                                                    CornerRadius="12" Padding="8,4">
                                                <TextBlock Text="{Binding Status}" FontSize="12" Foreground="White"/>
                                            </Border>
                                        </StackPanel>

                                        <!-- è€ƒè¯•æè¿° -->
                                        <TextBlock Text="{Binding Description}" 
                                                  TextWrapping="Wrap" 
                                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                                  IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                                        <!-- è€ƒè¯•è¯¦æƒ… -->
                                        <StackPanel Orientation="Horizontal" Spacing="20">
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock Text="ðŸ“Š" FontSize="14"/>
                                                <TextBlock Text="{Binding TotalScore, StringFormat={}{0} åˆ†}" FontSize="14"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock Text="â±ï¸" FontSize="14"/>
                                                <TextBlock Text="{Binding DurationMinutes, StringFormat={}{0} åˆ†é’Ÿ}" FontSize="14"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock Text="âœ…" FontSize="14"/>
                                                <TextBlock Text="{Binding PassingScore, StringFormat={}åŠæ ¼çº¿ {0} åˆ†}" FontSize="14"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- æ—¶é—´ä¿¡æ¯ -->
                                        <StackPanel Orientation="Horizontal" Spacing="20"
                                                   IsVisible="{Binding StartTime, Converter={x:Static ObjectConverters.IsNotNull}}">
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock Text="ðŸ•" FontSize="14"/>
                                                <TextBlock Text="{Binding StartTime, StringFormat={}å¼€å§‹æ—¶é—´: {0:yyyy-MM-dd HH:mm}}"
                                                          FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="5"
                                                       IsVisible="{Binding EndTime, Converter={x:Static ObjectConverters.IsNotNull}}">
                                                <TextBlock Text="ðŸ••" FontSize="14"/>
                                                <TextBlock Text="{Binding EndTime, StringFormat={}ç»“æŸæ—¶é—´: {0:yyyy-MM-dd HH:mm}}"
                                                          FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- æ“ä½œæŒ‰é’® -->
                                    <StackPanel Grid.Column="1" Orientation="Vertical" Spacing="10" VerticalAlignment="Center">
                                        <Button Content="æŸ¥çœ‹è¯¦æƒ…" 
                                                Command="{Binding $parent[UserControl].((vm:ExamListViewModel)DataContext).ViewDetailsCommand}"
                                                CommandParameter="{Binding}"
                                                Classes="accent"/>
                                        <Button Content="å¼€å§‹è€ƒè¯•"
                                                IsEnabled="True"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- ç©ºçŠ¶æ€ -->
                <Border IsVisible="{Binding !IsLoading}"
                        Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                        CornerRadius="5" Padding="40"
                        HorizontalAlignment="Center">
                    <Border.IsVisible>
                        <MultiBinding Converter="{x:Static BoolConverters.And}">
                            <Binding Path="!IsLoading"/>
                            <Binding Path="ErrorMessage" Converter="{x:Static StringConverters.IsNullOrEmpty}"/>
                        </MultiBinding>
                    </Border.IsVisible>
                    <StackPanel HorizontalAlignment="Center" Spacing="10">
                        <TextBlock Text="ðŸ“" FontSize="48" HorizontalAlignment="Center" Opacity="0.5"/>
                        <TextBlock Text="æš‚æ— å¯ç”¨çš„è€ƒè¯•" FontSize="16" HorizontalAlignment="Center" 
                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                        <TextBlock Text="è¯·è”ç³»è€å¸ˆå®‰æŽ’è€ƒè¯•æˆ–ç¨åŽå†è¯•" FontSize="14" HorizontalAlignment="Center" 
                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- åº•éƒ¨æ“ä½œæ  -->
        <Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                BorderThickness="0,1,0,0" Padding="20,15">
            <StackPanel Orientation="Horizontal" Spacing="15">
                <Button Content="åˆ·æ–°" Command="{Binding RefreshCommand}">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock Text="ðŸ”„" FontSize="14"/>
                            <TextBlock Text="åˆ·æ–°"/>
                        </StackPanel>
                    </Button.Content>
                </Button>
                
                <Button Content="åŠ è½½æ›´å¤š" 
                        Command="{Binding LoadMoreCommand}"
                        IsVisible="{Binding HasMoreData}">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock Text="â¬‡ï¸" FontSize="14"/>
                            <TextBlock Text="åŠ è½½æ›´å¤š"/>
                        </StackPanel>
                    </Button.Content>
                </Button>

                <TextBlock Text="{Binding Exams.Count, StringFormat={}å·²æ˜¾ç¤º {0} é¡¹}"
                          VerticalAlignment="Center" 
                          Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
