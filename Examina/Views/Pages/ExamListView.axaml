<UserControl x:Class="Examina.Views.Pages.ExamListView" xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:models="using:Examina.Models.Exam" xmlns:vm="using:Examina.ViewModels.Pages" d:DesignHeight="450" d:DesignWidth="800" x:DataType="vm:ExamListViewModel" mc:Ignorable="d">

    <Design.DataContext>
        <vm:ExamListViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!--  标题栏  -->
        <Border Grid.Row="0" Padding="20,15" Background="{DynamicResource SystemAccentColor}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Margin="0,0,10,0" VerticalAlignment="Center" FontSize="24" Text="📝" />
                <TextBlock VerticalAlignment="Center" FontSize="20" FontWeight="Bold" Foreground="White" Text="上机统考" />
                <TextBlock Margin="20,0,0,0" VerticalAlignment="Center" FontSize="14" Foreground="White" Opacity="0.8" Text="{Binding TotalCount, StringFormat={}共 {0} 场考试}" />
            </StackPanel>
        </Border>

        <!--  主内容区域  -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel Spacing="15">
                <!--  错误消息  -->
                <Border Padding="15" Background="#FFEBEE" BorderBrush="#F44336" BorderThickness="1" CornerRadius="5" IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="0,0,10,0" VerticalAlignment="Center" FontSize="16" Text="⚠️" />
                        <TextBlock VerticalAlignment="Center" Foreground="#D32F2F" Text="{Binding ErrorMessage}" />
                    </StackPanel>
                </Border>

                <!--  加载指示器  -->
                <Border Padding="20" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" CornerRadius="5" IsVisible="{Binding IsLoading}">
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                        <TextBlock Margin="0,0,10,0" VerticalAlignment="Center" FontSize="16" Text="🔄" />
                        <TextBlock VerticalAlignment="Center" Text="正在加载考试列表..." />
                    </StackPanel>
                </Border>

                <!--  考试列表  -->
                <ItemsControl ItemsSource="{Binding Exams}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:StudentExamDto">
                            <Border Margin="0,0,0,10" Padding="20" Background="Transparent" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8">
                                <Border.Styles>
                                    <Style Selector="Border:pointerover">
                                        <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListLowBrush}" />
                                        <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
                                    </Style>
                                </Border.Styles>

                                <Grid ColumnDefinitions="*,Auto">
                                    <!--  考试信息  -->
                                    <StackPanel Grid.Column="0" Spacing="8">
                                        <!--  考试名称和状态  -->
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <TextBlock FontSize="18" FontWeight="SemiBold" Text="{Binding Name}" />
                                            <Border Padding="8,4" Background="{DynamicResource SystemAccentColor}" CornerRadius="12">
                                                <TextBlock FontSize="12" Foreground="White" Text="{Binding Status}" />
                                            </Border>
                                        </StackPanel>

                                        <!--  考试描述  -->
                                        <TextBlock Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" Text="{Binding Description}" TextWrapping="Wrap" />

                                        <!--  考试详情  -->
                                        <StackPanel Orientation="Horizontal" Spacing="20">
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock FontSize="14" Text="📊" />
                                                <TextBlock FontSize="14" Text="{Binding TotalScore, StringFormat={}{0} 分}" />
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock FontSize="14" Text="⏱️" />
                                                <TextBlock FontSize="14" Text="{Binding DurationMinutes, StringFormat={}{0} 分钟}" />
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock FontSize="14" Text="✅" />
                                                <TextBlock FontSize="14" Text="{Binding PassingScore, StringFormat={}及格线 {0} 分}" />
                                            </StackPanel>
                                        </StackPanel>

                                        <!--  时间信息  -->
                                        <StackPanel IsVisible="{Binding StartTime, Converter={x:Static ObjectConverters.IsNotNull}}" Orientation="Horizontal" Spacing="20">
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <TextBlock FontSize="14" Text="🕐" />
                                                <TextBlock FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="{Binding StartTime, StringFormat={}开始时间: {0:yyyy-MM-dd HH:mm}}" />
                                            </StackPanel>
                                            <StackPanel IsVisible="{Binding EndTime, Converter={x:Static ObjectConverters.IsNotNull}}" Orientation="Horizontal" Spacing="5">
                                                <TextBlock FontSize="14" Text="🕕" />
                                                <TextBlock FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="{Binding EndTime, StringFormat={}结束时间: {0:yyyy-MM-dd HH:mm}}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>

                                    <!--  操作按钮  -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Orientation="Vertical" Spacing="10">
                                        <Button Classes="accent" Command="{Binding $parent[UserControl].((vm:ExamListViewModel)DataContext).ViewDetailsCommand}" CommandParameter="{Binding}" Content="查看详情" />
                                        <Button Content="开始考试" IsEnabled="True" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!--  空状态  -->
                <Border Padding="40" HorizontalAlignment="Center" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" CornerRadius="5" IsVisible="{Binding !IsLoading}">
                    <Border.IsVisible>
                        <MultiBinding Converter="{x:Static BoolConverters.And}">
                            <Binding Path="!IsLoading" />
                            <Binding Converter="{x:Static StringConverters.IsNullOrEmpty}" Path="ErrorMessage" />
                        </MultiBinding>
                    </Border.IsVisible>
                    <StackPanel HorizontalAlignment="Center" Spacing="10">
                        <TextBlock HorizontalAlignment="Center" FontSize="48" Opacity="0.5" Text="📝" />
                        <TextBlock HorizontalAlignment="Center" FontSize="16" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="暂无可用的考试" />
                        <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="请联系老师安排考试或稍后再试" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!--  底部操作栏  -->
        <Border Grid.Row="2" Padding="20,15" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" Spacing="15">
                <Button Command="{Binding RefreshCommand}" Content="刷新">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock FontSize="14" Text="🔄" />
                            <TextBlock Text="刷新" />
                        </StackPanel>
                    </Button.Content>
                </Button>

                <Button Command="{Binding LoadMoreCommand}" Content="加载更多" IsVisible="{Binding HasMoreData}">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock FontSize="14" Text="⬇️" />
                            <TextBlock Text="加载更多" />
                        </StackPanel>
                    </Button.Content>
                </Button>

                <TextBlock VerticalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="{Binding Exams.Count, StringFormat={}已显示 {0} 项}" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
